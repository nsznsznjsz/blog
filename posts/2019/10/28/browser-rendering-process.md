---
date: 2019-10-28
updated: 2019-10-28
categories:
  - Computer Science
  - Front End
tags:
  - Browser
---

# 从 url -> 网页

- [从 url -> 网页](#从-url---网页)
- [1. 请求内容](#1-请求内容)
- [2. 构建朴素的 DOM 树](#2-构建朴素的-dom-树)
  - [流式解析](#流式解析)
- [3. 计算 CSS](#3-计算-css)
  - [流式渲染](#流式渲染)
  - [渲染顺序](#渲染顺序)
  - [选择器](#选择器)
  - [没有父选择器](#没有父选择器)
- [4. 渲染](#4-渲染)
  - [盒模型](#盒模型)
  - [排版](#排版)
  - [流式渲染](#流式渲染-1)
- [5. 位图合成(可选)](#5-位图合成可选)
- [6. 绘制](#6-绘制)

# 1. 请求内容

HTTP / HTTPS 请求数据, url -> 文本内容

# 2. 构建朴素的 DOM 树

## 流式解析
  
状态机分词: https://github.com/aimergenge/toy-html-parser

# 3. 计算 CSS

## 流式渲染

每生成一个dom节点, 便立刻去匹配相应的css规则

## 渲染顺序

父节点 -> 子节点

## 选择器

- 混合选择器 

在激活的时候父元素已经确定好了

- 后代选择器

所有元素都是父元素，并选中自己的子元素

- 子元素选择器

只有父元素为当前节点的 dom  元素会被选中

- 在父元素结束标签时，关闭选择器

## 没有父选择器

在保证选择器在 DOM 树构建到当前节点时, 已经可以准确判断是是否匹配, 不需要后续节点信息, 保证了上述三条的正常工作

# 4. 渲染

**作用** 得到内存中的位图

流式渲染

## 盒模型

box-sizing: content-box, border-box, inherit

## 排版
  
- 正常流: 
  - 顺次排版
  - 文字流: 行模型, 折行
  - 盒模型
- 绝对定位
- **浮动定位**: 先进正常流, 再浮动, 会引起整行重排
- flex
- grid
- 表格排版

## 流式渲染

# 5. 位图合成(可选)

**作用** 把子元素合成到父元素盒中

**目的** 加快绘制速度, 最大程度优化渲染

**方法** 猜测不变的元素

- position
- transform
- will-change CSS3 谨慎使用

# 6. 绘制